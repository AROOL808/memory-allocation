<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Manajemen Memori</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        .memory-block {
            transition: all 0.3s ease;
        }
        .memory-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
    
    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-center text-indigo-700 mb-2">Simulasi Manajemen Memori</h1>
            <div class="w-24 h-1 bg-indigo-500 mx-auto mb-6 rounded-full"></div>
            
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Input Data</h2>
            
            <div class="space-y-4">
                <div>
                    <label for="memory" class="block text-gray-700 font-medium mb-2">Blok Memory (pisahkan dengan koma):</label>
                    <input type="text" id="memory" placeholder="Contoh: 100, 500, 200, 300, 600" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                </div>
                
                <div>
                    <label for="processes" class="block text-gray-700 font-medium mb-2">Kebutuhan Memory Proses (pisahkan dengan koma):</label>
                    <input type="text" id="processes" placeholder="Contoh: 212, 417, 112, 426" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button onclick="runSimulation()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-lg transition duration-300 flex-1">
                        <span class="flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Jalankan Simulasi
                        </span>
                    </button>
                    <button onclick="resetSimulation()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 flex-1">
                        <span class="flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Reset
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="flex border-b border-gray-200">
                <button class="tab active flex-1 py-4 px-6 text-center font-medium transition duration-300 bg-indigo-600 text-white hover:bg-indigo-700" onclick="openTab(event, 'firstFitTab')">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        First-Fit
                    </span>
                </button>
                <button class="tab flex-1 py-4 px-6 text-center font-medium transition duration-300 text-gray-700 hover:bg-gray-100" onclick="openTab(event, 'bestFitTab')">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Best-Fit
                    </span>
                </button>
                <button class="tab flex-1 py-4 px-6 text-center font-medium transition duration-300 text-gray-700 hover:bg-gray-100" onclick="openTab(event, 'worstFitTab')">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Worst-Fit
                    </span>
                </button>
            </div>
            
            <div id="firstFitTab" class="tab-content active p-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    First-Fit
                </h2>
                <div id="firstFitResult" class="bg-gray-50 p-4 rounded-lg min-h-64">
                    <div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>
                </div>
            </div>
            
            <div id="bestFitTab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Best-Fit
                </h2>
                <div id="bestFitResult" class="bg-gray-50 p-4 rounded-lg min-h-64">
                    <div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>
                </div>
            </div>
            
            <div id="worstFitTab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Worst-Fit
                </h2>
                <div id="worstFitResult" class="bg-gray-50 p-4 rounded-lg min-h-64">
                    <div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Algoritma First-Fit
        function firstFit(memory, proc) {
            let blocks = [...memory];
            let allocation = Array(proc.length).fill(-1);
            let processesInfo = [];
            let blocksInfo = [];
            let pendingFragments = []; 

            // Inisialisasi blok awal (blok ke-0 sampai ke-4)
            for (let i = 0; i < blocks.length; i++) {
                blocksInfo.push({
                    id: i,
                    size: blocks[i],
                    status: "Free"
                });
            }

            for (let i = 0; i < proc.length; i++) {
                for (let j = 0; j < blocks.length; j++) {
                    if (blocks[j] >= proc[i] && blocksInfo[j].status === "Free") {
                        allocation[i] = j;

                        let originalSize = blocks[j];
                        let fragmentSize = originalSize - proc[i];

                        // Update blok utama dengan ukuran proses
                        blocks[j] = proc[i];
                        blocksInfo[j] = {
                            id: j,
                            size: proc[i],
                            status: "Allocated",
                            processId: i
                        };

                        // Simpan fragment ke antrian
                        if (fragmentSize > 0) {
                            pendingFragments.push({
                                size: fragmentSize,
                                status: "Free"
                            });
                        }

                        processesInfo.push({
                            processId: i,
                            size: proc[i],
                            allocatedBlockId: j,
                            status: "Allocated"
                        });

                        break;
                    }
                }

                if (allocation[i] === -1) {
                    processesInfo.push({
                        processId: i,
                        size: proc[i],
                        allocatedBlockId: -1,
                        status: "Not Allocated"
                    });
                }
            }

            // Setelah alokasi selesai, tambahkan fragment setelah blok ke-4
            let insertIndex = blocks.length; // setelah blok terakhir
            for (let frag of pendingFragments) {
                blocks.splice(insertIndex, 0, frag.size);
                blocksInfo.splice(insertIndex, 0, {
                    id: -1, 
                    size: frag.size,
                    status: "Free"
                });
                insertIndex++; 
            }

            // Reset ulang ID blok agar urut
            for (let i = 0; i < blocksInfo.length; i++) {
                blocksInfo[i].id = i;
            }

            return {
                algorithm: "First-Fit",
                allocation: allocation,
                blocks: blocksInfo,
                processes: processesInfo
            };
        }

        // Algoritma Best-Fit
        function bestFit(memory, proc) {
            // Membuat salinan array memori agar tidak mengubah array asli
            let blocks = [...memory];
            let allocation = Array(proc.length).fill(-1);
            let processesInfo = [];
            let blocksInfo = [];
            
            // Mencatat informasi awal blok memori
            for (let i = 0; i < blocks.length; i++) {
                blocksInfo.push({
                    id: i,
                    size: blocks[i],
                    status: "Free"
                });
            }
            
            // Tambahkan array untuk melacak blok yang telah dialokasikan
            let blockAllocated = Array(blocks.length).fill(false);
            
            // Alokasi untuk setiap proses
            for (let i = 0; i < proc.length; i++) {
                let bestIdx = -1;
                
                // Cari blok terkecil yang cukup untuk proses dan belum dialokasikan
                for (let j = 0; j < blocks.length; j++) {
                    // Periksa apakah blok belum dialokasikan dan ukurannya cukup
                    if (!blockAllocated[j] && blocks[j] >= proc[i]) {
                        if (bestIdx === -1 || blocks[j] < blocks[bestIdx]) {
                            bestIdx = j;
                        }
                    }
                }
                
                // Jika ditemukan blok yang cocok
                if (bestIdx !== -1) {
                    allocation[i] = bestIdx;
                    // Tandai blok sebagai telah dialokasikan
                    blockAllocated[bestIdx] = true;
                    
                    // Pecah blok jika ukurannya lebih besar dari kebutuhan proses
                    let fragmentSize = blocks[bestIdx] - proc[i];
                    if (fragmentSize > 0) {
                        // Kurangi ukuran blok asli
                        blocks[bestIdx] = proc[i];
                        
                        // Tambahkan blok baru untuk fragmen yang tersisa
                        blocks.push(fragmentSize);
                        blockAllocated.push(false); // Tambahkan status alokasi untuk blok baru
                        blocksInfo.push({
                            id: blocksInfo.length,
                            size: fragmentSize,
                            status: "Free"
                        });
                    }
                    
                    // Update informasi blok
                    blocksInfo[bestIdx] = {
                        id: bestIdx,
                        size: blocks[bestIdx],
                        status: "Allocated",
                        processId: i
                    };
                    
                    // Tambahkan informasi proses
                    processesInfo.push({
                        processId: i,
                        size: proc[i],
                        allocatedBlockId: bestIdx,
                        status: "Allocated"
                    });
                } else {
                    // Jika proses tidak dapat dialokasikan
                    processesInfo.push({
                        processId: i,
                        size: proc[i],
                        allocatedBlockId: -1,
                        status: "Not Allocated"
                    });
                }
            }
            
            return {
                algorithm: "Best-Fit",
                allocation: allocation,
                blocks: blocksInfo,
                processes: processesInfo
            };
        }

        // Algoritma Worst-Fit
        function worstFit(memory, proc) {
            let blocks = [...memory];
            let allocation = Array(proc.length).fill(-1);
            let processesInfo = [];
            let blocksInfo = [];
            let pendingFragments = [];

            // Mencatat blok awal
            for (let i = 0; i < blocks.length; i++) {
                blocksInfo.push({
                    id: i,
                    size: blocks[i],
                    status: "Free"
                });
            }

            for (let i = 0; i < proc.length; i++) {
                let worstIdx = -1;

                // Cari blok terbesar yang cukup
                for (let j = 0; j < blocks.length; j++) {
                    if (blocks[j] >= proc[i] && blocksInfo[j].status === "Free") {
                        if (worstIdx === -1 || blocks[j] > blocks[worstIdx]) {
                            worstIdx = j;
                        }
                    }
                }

                if (worstIdx !== -1) {
                    allocation[i] = worstIdx;

                    let fragmentSize = blocks[worstIdx] - proc[i];
                    blocks[worstIdx] = proc[i];

                    // Update blok yang dipakai
                    blocksInfo[worstIdx] = {
                        id: worstIdx,
                        size: proc[i],
                        status: "Allocated",
                        processId: i
                    };

                    if (fragmentSize > 0) {
                        pendingFragments.push({
                            size: fragmentSize,
                            status: "Free"
                        });
                    }

                    processesInfo.push({
                        processId: i,
                        size: proc[i],
                        allocatedBlockId: worstIdx,
                        status: "Allocated"
                    });
                } else {
                    processesInfo.push({
                        processId: i,
                        size: proc[i],
                        allocatedBlockId: -1,
                        status: "Not Allocated"
                    });
                }
            }

            // Tambahkan fragment setelah blok awal
            let insertIndex = blocks.length; 
            for (let frag of pendingFragments) {
                blocks.splice(insertIndex, 0, frag.size);
                blocksInfo.splice(insertIndex, 0, {
                    id: -1, 
                    size: frag.size,
                    status: "Free"
                });
                insertIndex++;
            }

            // Update ulang ID blok agar berurutan
            for (let i = 0; i < blocksInfo.length; i++) {
                blocksInfo[i].id = i;
            }

            return {
                algorithm: "Worst-Fit",
                allocation: allocation,
                blocks: blocksInfo,
                processes: processesInfo
            };
        }

        function openTab(evt, tabName) {
            // Hide all tab content
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            // Remove active class from all tabs
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("bg-indigo-600", "text-white");
                tabs[i].classList.add("text-gray-700");
            }
            
            // Show the specific tab content
            document.getElementById(tabName).classList.add("active");
            
            // Add active class to the button that opened the tab
            evt.currentTarget.classList.remove("text-gray-700");
            evt.currentTarget.classList.add("bg-indigo-600", "text-white");
        }

        function runSimulation() {
            // Parse input data
            const memoryInput = document.getElementById("memory").value;
            const processesInput = document.getElementById("processes").value;
            
            // Validate input
            if (!memoryInput || !processesInput) {
                alert("Mohon masukkan data blok memori dan kebutuhan proses!");
                return;
            }
            
            // Convert input to arrays
            const memory = memoryInput.split(",").map(x => parseInt(x.trim()));
            const processes = processesInput.split(",").map(x => parseInt(x.trim()));
            
            if (memory.some(isNaN) || processes.some(isNaN)) {
                alert("Input tidak valid! Pastikan semua nilai adalah angka.");
                return;
            }
            
            // Run algorithms
            const firstFitResult = firstFit(memory, processes);
            const bestFitResult = bestFit(memory, processes);
            const worstFitResult = worstFit(memory, processes);
            
            // Display results
            displayResult("firstFitResult", firstFitResult);
            displayResult("bestFitResult", bestFitResult);
            displayResult("worstFitResult", worstFitResult);
        }
        
        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            
            let html = '';
            
            // Visualize memory blocks
            html += `<div class="mb-6">
                        <h3 class="font-medium text-gray-700 mb-2">Status Blok Memori:</h3>
                        <div class="flex flex-wrap gap-2 mb-4">`;
            
            result.blocks.forEach(block => {
                const colorClass = block.status === "Allocated" 
                    ? "bg-indigo-100 border-indigo-300" 
                    : "bg-green-100 border-green-300";
                const statusClass = block.status === "Allocated" 
                    ? "bg-indigo-500" 
                    : "bg-green-500";
                
                html += `<div class="memory-block p-3 rounded-md ${colorClass} border flex flex-col items-center">
                            <span class="text-sm font-medium">Blok ${block.id}</span>
                            <span class="text-lg font-bold">${block.size} KB</span>
                            <span class="text-xs px-2 py-1 rounded-full ${statusClass} text-white mt-1">${block.status}</span>
                            ${block.status === "Allocated" ? `<span class="text-xs mt-1">Proses ${block.processId}</span>` : ''}
                        </div>`;
            });
            
            html += `</div></div>`;
            
            // Visualize processes
            html += `<div class="mb-6">
                        <h3 class="font-medium text-gray-700 mb-2">Status Proses:</h3>
                        <div class="flex flex-wrap gap-2 mb-4">`;
            
            result.processes.forEach(process => {
                const allocated = process.allocatedBlockId !== -1;
                const colorClass = allocated 
                    ? "bg-indigo-100 border-indigo-300" 
                    : "bg-red-100 border-red-300";
                const statusClass = allocated 
                    ? "bg-indigo-500" 
                    : "bg-red-500";
                const status = allocated ? "Teralokasi" : "Menunggu";
                
                html += `<div class="memory-block p-3 rounded-md ${colorClass} border flex flex-col items-center">
                            <span class="text-sm font-medium">Proses ${process.processId}</span>
                            <span class="text-lg font-bold">${process.size} KB</span>
                            <span class="text-xs px-2 py-1 rounded-full ${statusClass} text-white mt-1">${status}</span>
                            ${allocated ? `<span class="text-xs mt-1">Blok ${process.allocatedBlockId}</span>` : ''}
                        </div>`;
            });
            
            html += `</div></div>`;
            
            // Table with allocation details
            html += `<div>
                        <h3 class="font-medium text-gray-700 mb-2">Hasil Alokasi ${result.algorithm}:</h3>
                        <div class="bg-white border border-gray-200 rounded-md p-3 overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="py-2 text-left">Proses</th>
                                        <th class="py-2 text-left">Ukuran</th>
                                        <th class="py-2 text-left">Blok Memori</th>
                                        <th class="py-2 text-left">Status</th>
                                    </tr>
                                </thead>
                                <tbody>`;
            
            result.processes.forEach(process => {
                const allocated = process.allocatedBlockId !== -1;
                const statusClass = allocated ? "text-green-600" : "text-red-600";
                const status = allocated ? "Teralokasi" : "Tidak Teralokasi";
                
                html += `<tr class="border-b">
                            <td class="py-2">Proses ${process.processId}</td>
                            <td class="py-2">${process.size} KB</td>
                            <td class="py-2">${allocated ? `Blok ${process.allocatedBlockId}` : "-"}</td>
                            <td class="py-2"><span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">${status}</span></td>
                        </tr>`;
            });
            
            html += `</tbody></table></div>
                    
                    <div class="mt-4 p-3 bg-gray-50 rounded-md border border-gray-200">
                        <div class="text-sm text-gray-600">
                            <p><span class="font-medium">Jumlah blok memori:</span> ${result.blocks.length}</p>
                            <p><span class="font-medium">Blok free:</span> ${result.blocks.filter(b => b.status === "Free").length}</p>
                            <p><span class="font-medium">Proses teralokasi:</span> ${result.processes.filter(p => p.allocatedBlockId !== -1).length} dari ${result.processes.length}</p>
                        </div>
                    </div>
                    </div>`;
            
            element.innerHTML = html;
        }
        
        function resetSimulation() {
            document.getElementById("memory").value = "";
            document.getElementById("processes").value = "";
            
            // Reset result displays
            document.getElementById("firstFitResult").innerHTML = '<div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>';
            document.getElementById("bestFitResult").innerHTML = '<div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>';
            document.getElementById("worstFitResult").innerHTML = '<div class="text-gray-500 text-center py-8">Hasil simulasi akan ditampilkan di sini...</div>';
        }
    </script>
</body>
</html>
